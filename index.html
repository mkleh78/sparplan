import React, { useState, useEffect } from 'react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, AreaChart, Area, BarChart, Bar, PieChart, Pie, Cell } from 'recharts';

const COLORS = ['#001d6c', '#e2fe6c', '#253c8a', '#cfdbf7'];

const formatter = new Intl.NumberFormat('de-DE', {
  style: 'currency',
  currency: 'EUR',
  minimumFractionDigits: 0,
  maximumFractionDigits: 0,
});

const percentFormatter = new Intl.NumberFormat('de-DE', {
  style: 'percent',
  minimumFractionDigits: 2,
  maximumFractionDigits: 2,
});

const ETFSparplanrechner = () => {
  const [formData, setFormData] = useState({
    initialInvestment: 10000,
    monthlyContribution: 500,
    yearsToInvest: 20,
    expectedReturnRate: 7,
    annualFees: 0.2,
    taxRate: 26.375, // Kapitalertragssteuer + Soli
    inflationRate: 2,
  });

  const [chartData, setChartData] = useState([]);
  const [summary, setSummary] = useState({
    totalInvestment: 0,
    totalReturns: 0,
    totalAfterTax: 0,
    totalAfterInflation: 0,
    totalValue: 0,
  });
  const [activeTab, setActiveTab] = useState('wachstum');
  const [compareData, setCompareData] = useState([]);
  const [showAdvanced, setShowAdvanced] = useState(false);

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData({
      ...formData,
      [name]: parseFloat(value) || 0,
    });
  };

  useEffect(() => {
    calculateInvestment();
  }, [formData]);

  const calculateInvestment = () => {
    const {
      initialInvestment,
      monthlyContribution,
      yearsToInvest,
      expectedReturnRate,
      annualFees,
      taxRate,
      inflationRate,
    } = formData;

    const months = yearsToInvest * 12;
    const monthlyRate = (expectedReturnRate - annualFees) / 100 / 12;
    const inflationMonthlyRate = inflationRate / 100 / 12;
    
    let currentValue = initialInvestment;
    let totalContributions = initialInvestment;
    let data = [];
    
    for (let month = 0; month <= months; month++) {
      // Calculate values before tax
      const yearPoint = month / 12;
      const earned = month > 0 ? currentValue * monthlyRate : 0;
      currentValue += earned + (month > 0 ? monthlyContribution : 0);
      
      if (month > 0) {
        totalContributions += monthlyContribution;
      }

      // Calculate taxable earnings
      const totalEarnings = currentValue - totalContributions;
      const taxPaid = totalEarnings > 0 ? (totalEarnings * (taxRate / 100)) : 0;
      const valueAfterTax = currentValue - taxPaid;
      
      // Calculate inflation-adjusted value
      const inflationFactor = Math.pow(1 + inflationMonthlyRate, month);
      const valueAfterInflation = valueAfterTax / inflationFactor;

      // Only include data points for the beginning of each year or the final month
      if (month % 12 === 0 || month === months) {
        data.push({
          year: Math.floor(yearPoint),
          month: month,
          totalContributions: totalContributions,
          investment: currentValue,
          returns: totalEarnings,
          afterTax: valueAfterTax,
          afterInflation: valueAfterInflation,
          earned: earned,
        });
      }
    }

    // Generate comparison data for different monthly contributions
    const comparisonRates = [
      { label: 'Konservativ (4%)', rate: 4 },
      { label: 'Moderat (7%)', rate: 7 },
      { label: 'Optimistisch (10%)', rate: 10 },
    ];
    
    const compareResults = comparisonRates.map(({ label, rate }) => {
      const monthlyRateComp = (rate - annualFees) / 100 / 12;
      let valueComp = initialInvestment;
      let contributionsComp = initialInvestment;
      
      for (let month = 1; month <= months; month++) {
        valueComp += valueComp * monthlyRateComp + monthlyContribution;
        contributionsComp += monthlyContribution;
      }
      
      return {
        label,
        value: valueComp,
        contributions: contributionsComp,
        returns: valueComp - contributionsComp
      };
    });

    setChartData(data);
    setCompareData(compareResults);
    
    const lastDataPoint = data[data.length - 1];
    setSummary({
      totalInvestment: lastDataPoint.totalContributions,
      totalReturns: lastDataPoint.returns,
      totalValue: lastDataPoint.investment,
      totalAfterTax: lastDataPoint.afterTax,
      totalAfterInflation: lastDataPoint.afterInflation,
    });
  };

  const renderTooltipContent = (props) => {
    const { payload, label } = props;
    if (payload && payload.length > 0) {
      return (
        <div className="bg-white p-4 border border-gray-300 rounded-lg shadow-md">
          <p className="font-bold mb-2">Jahr {label}</p>
          {payload.map((entry, index) => {
            if (entry.dataKey === "totalContributions") {
              return (
                <p key={`item-${index}`} style={{ color: entry.color }}>
                  Einzahlungen: {formatter.format(entry.value)}
                </p>
              );
            } else if (entry.dataKey === "investment") {
              return (
                <p key={`item-${index}`} style={{ color: entry.color }}>
                  Depotwert: {formatter.format(entry.value)}
                </p>
              );
            } else if (entry.dataKey === "afterTax") {
              return (
                <p key={`item-${index}`} style={{ color: entry.color }}>
                  Nach Steuern: {formatter.format(entry.value)}
                </p>
              );
            } else if (entry.dataKey === "afterInflation") {
              return (
                <p key={`item-${index}`} style={{ color: entry.color }}>
                  Kaufkraft: {formatter.format(entry.value)}
                </p>
              );
            }
            return null;
          })}
        </div>
      );
    }
    return null;
  };

  const renderCompareTooltip = (props) => {
    const { payload } = props;
    if (payload && payload.length > 0) {
      const item = payload[0].payload;
      return (
        <div className="bg-white p-4 border border-gray-300 rounded-lg shadow-md">
          <p className="font-bold mb-2">{item.label}</p>
          <p>Gesamtwert: {formatter.format(item.value)}</p>
          <p>Einzahlungen: {formatter.format(item.contributions)}</p>
          <p>Rendite: {formatter.format(item.returns)}</p>
        </div>
      );
    }
    return null;
  };

  const renderBreakdownTooltip = (props) => {
    const { payload } = props;
    if (payload && payload.length > 0) {
      return (
        <div className="bg-white p-4 border border-gray-300 rounded-lg shadow-md">
          <p className="font-bold mb-2">{payload[0].name}</p>
          <p>{formatter.format(payload[0].value)} ({((payload[0].value / summary.totalValue) * 100).toFixed(1)}%)</p>
        </div>
      );
    }
    return null;
  };

  const renderGrowthChart = () => (
    <div className="bg-white p-6 rounded-lg shadow-md mb-6">
      <h3 className="text-lg font-bold mb-4 text-secondary">Wachstum über {formData.yearsToInvest} Jahre</h3>
      <ResponsiveContainer width="100%" height={400}>
        <AreaChart
          data={chartData}
          margin={{ top: 10, right: 30, left: 20, bottom: 40 }}
        >
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis 
            dataKey="year" 
            label={{ value: 'Jahre', position: 'insideBottomRight', offset: -10 }} 
          />
          <YAxis 
            tickFormatter={(value) => formatter.format(value)} 
            label={{ value: 'Wert', angle: -90, position: 'insideLeft' }} 
          />
          <Tooltip content={renderTooltipContent} />
          <Legend />
          <Area type="monotone" dataKey="investment" name="Depotwert" stackId="1" stroke="#001d6c" fill="#253c8a" fillOpacity={0.8} />
          <Area type="monotone" dataKey="totalContributions" name="Einzahlungen" stackId="2" stroke="#e2fe6c" fill="#e2fe6c" fillOpacity={0.6} />
          {showAdvanced && (
            <>
              <Area type="monotone" dataKey="afterTax" name="Nach Steuern" stackId="3" stroke="#cfdbf7" fill="#cfdbf7" />
              <Area type="monotone" dataKey="afterInflation" name="Kaufkraft" stackId="4" stroke="#edf0f7" fill="#edf0f7" />
            </>
          )}
        </AreaChart>
      </ResponsiveContainer>
    </div>
  );

  const renderComparisonChart = () => (
    <div className="bg-white p-6 rounded-lg shadow-md mb-6">
      <h3 className="text-lg font-bold mb-4 text-secondary">Vergleich verschiedener Renditen</h3>
      <ResponsiveContainer width="100%" height={400}>
        <BarChart
          data={compareData}
          margin={{ top: 10, right: 30, left: 20, bottom: 40 }}
        >
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis dataKey="label" />
          <YAxis tickFormatter={(value) => formatter.format(value)} />
          <Tooltip content={renderCompareTooltip} />
          <Legend />
          <Bar dataKey="contributions" name="Einzahlungen" fill="#e2fe6c" />
          <Bar dataKey="returns" name="Rendite" fill="#001d6c" />
        </BarChart>
      </ResponsiveContainer>
    </div>
  );

  const renderBreakdownChart = () => {
    const data = [
      { name: 'Einzahlungen', value: summary.totalInvestment },
      { name: 'Rendite', value: summary.totalReturns },
    ];

    return (
      <div className="bg-white p-6 rounded-lg shadow-md mb-6">
        <h3 className="text-lg font-bold mb-4 text-secondary">Aufteilung nach {formData.yearsToInvest} Jahren</h3>
        <ResponsiveContainer width="100%" height={400}>
          <PieChart>
            <Pie
              data={data}
              cx="50%"
              cy="50%"
              outerRadius={150}
              fill="#8884d8"
              dataKey="value"
              label={({ name, percent }) => `${name}: ${(percent * 100).toFixed(0)}%`}
            >
              {data.map((entry, index) => (
                <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
              ))}
            </Pie>
            <Tooltip content={renderBreakdownTooltip} />
            <Legend />
          </PieChart>
        </ResponsiveContainer>
      </div>
    );
  };

  const renderActiveTab = () => {
    switch (activeTab) {
      case 'wachstum':
        return renderGrowthChart();
      case 'vergleich':
        return renderComparisonChart();
      case 'aufteilung':
        return renderBreakdownChart();
      default:
        return renderGrowthChart();
    }
  };

  return (
    <div className="fade-in" style={{ backgroundColor: '#f5f7fa', borderRadius: '12px', boxShadow: '0 8px 24px rgba(0,0,0,0.12)', padding: '2rem', maxWidth: '1200px', margin: '0 auto', fontFamily: "'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif" }}>
      <div className="mb-8">
        <div className="section-title">
          <h2 style={{ display: 'inline-block', position: 'relative', color: '#001d6c', fontSize: 'clamp(1.5rem, 4vw, 2rem)', lineHeight: '1.2', fontWeight: '700', paddingBottom: '12px', marginBottom: '3rem', textAlign: 'center' }}>
            ETF-Sparplanrechner
            <span style={{ content: "''", position: 'absolute', left: '25%', bottom: '0', width: '50%', height: '4px', backgroundColor: '#e2fe6c', borderRadius: '4px' }}></span>
          </h2>
        </div>
        
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '2.5rem' }}>
          <div className="card" style={{ 
            backgroundColor: 'white', 
            borderRadius: '12px', 
            boxShadow: '0 4px 12px rgba(0,0,0,0.1)', 
            padding: '2rem', 
            transition: 'all 0.3s ease', 
            position: 'relative', 
            display: 'flex', 
            flexDirection: 'column', 
            height: '100%' 
          }}>
            <h3 style={{ display: 'flex', alignItems: 'center', color: '#001d6c', marginBottom: '1rem' }}>
              <span style={{ 
                width: '40px', 
                height: '40px', 
                backgroundColor: '#e2fe6c', 
                borderRadius: '50%', 
                display: 'flex', 
                alignItems: 'center', 
                justifyContent: 'center', 
                marginRight: '1rem', 
                fontSize: '1.2rem', 
                fontWeight: 'bold', 
                boxShadow: '0 4px 8px rgba(0,0,0,0.1)', 
                flexShrink: '0' 
              }}>E</span>
              Eingabedaten
            </h3>
            
            <div style={{ display: 'flex', flexDirection: 'column', gap: '1.5rem' }}>
              <div>
                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '500' }}>
                  Anfangsinvestition
                </label>
                <div style={{ position: 'relative' }}>
                  <div style={{ position: 'absolute', left: '1rem', top: '50%', transform: 'translateY(-50%)', pointerEvents: 'none', color: '#555' }}>
                    €
                  </div>
                  <input
                    type="number"
                    name="initialInvestment"
                    value={formData.initialInvestment}
                    onChange={handleInputChange}
                    style={{ 
                      width: '100%', 
                      padding: '0.9rem 1rem 0.9rem 2rem', 
                      border: '1px solid #ddd', 
                      borderRadius: '8px', 
                      fontSize: '1rem', 
                      transition: 'all 0.3s ease',
                      fontFamily: 'inherit'
                    }}
                  />
                </div>
              </div>
              
              <div>
                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '500' }}>
                  Monatliche Sparrate
                </label>
                <div style={{ position: 'relative' }}>
                  <div style={{ position: 'absolute', left: '1rem', top: '50%', transform: 'translateY(-50%)', pointerEvents: 'none', color: '#555' }}>
                    €
                  </div>
                  <input
                    type="number"
                    name="monthlyContribution"
                    value={formData.monthlyContribution}
                    onChange={handleInputChange}
                    style={{ 
                      width: '100%', 
                      padding: '0.9rem 1rem 0.9rem 2rem', 
                      border: '1px solid #ddd', 
                      borderRadius: '8px', 
                      fontSize: '1rem', 
                      transition: 'all 0.3s ease',
                      fontFamily: 'inherit'
                    }}
                  />
                </div>
              </div>
              
              <div>
                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '500' }}>
                  Anlagezeitraum (Jahre)
                </label>
                <input
                  type="range"
                  name="yearsToInvest"
                  min="1"
                  max="40"
                  value={formData.yearsToInvest}
                  onChange={handleInputChange}
                  style={{ 
                    width: '100%', 
                    height: '8px', 
                    backgroundColor: '#edf0f7', 
                    borderRadius: '4px', 
                    appearance: 'none', 
                    cursor: 'pointer' 
                  }}
                />
                <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '0.875rem', color: '#555', marginTop: '0.5rem' }}>
                  <span>1</span>
                  <span>{formData.yearsToInvest}</span>
                  <span>40</span>
                </div>
              </div>
              
              <div>
                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '500' }}>
                  Erwartete jährliche Rendite (%)
                </label>
                <input
                  type="range"
                  name="expectedReturnRate"
                  min="1"
                  max="15"
                  step="0.1"
                  value={formData.expectedReturnRate}
                  onChange={handleInputChange}
                  style={{ 
                    width: '100%', 
                    height: '8px', 
                    backgroundColor: '#edf0f7', 
                    borderRadius: '4px', 
                    appearance: 'none', 
                    cursor: 'pointer' 
                  }}
                />
                <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '0.875rem', color: '#555', marginTop: '0.5rem' }}>
                  <span>1%</span>
                  <span>{formData.expectedReturnRate.toFixed(1)}%</span>
                  <span>15%</span>
                </div>
              </div>
              
              <button 
                style={{ 
                  backgroundColor: 'transparent', 
                  border: 'none', 
                  color: '#001d6c', 
                  fontSize: '0.9rem', 
                  cursor: 'pointer', 
                  textAlign: 'left', 
                  marginTop: '0.5rem',
                  fontWeight: '500',
                  padding: '0',
                  textDecoration: 'underline',
                  fontFamily: 'inherit'
                }}
                onClick={() => setShowAdvanced(!showAdvanced)}
              >
                {showAdvanced ? "Erweiterte Optionen ausblenden" : "Erweiterte Optionen anzeigen"}
              </button>
              
              {showAdvanced && (
                <div style={{ padding: '1.5rem 0 0', borderTop: '1px solid #edf0f7', marginTop: '1rem', display: 'flex', flexDirection: 'column', gap: '1.5rem' }}>
                  <div>
                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '500' }}>
                      Jährliche Fondskosten (%)
                    </label>
                    <input
                      type="range"
                      name="annualFees"
                      min="0"
                      max="2"
                      step="0.05"
                      value={formData.annualFees}
                      onChange={handleInputChange}
                      style={{ 
                        width: '100%', 
                        height: '8px', 
                        backgroundColor: '#edf0f7', 
                        borderRadius: '4px', 
                        appearance: 'none', 
                        cursor: 'pointer' 
                      }}
                    />
                    <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '0.875rem', color: '#555', marginTop: '0.5rem' }}>
                      <span>0%</span>
                      <span>{formData.annualFees.toFixed(2)}%</span>
                      <span>2%</span>
                    </div>
                  </div>
                  
                  <div>
                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '500' }}>
                      Kapitalertragsteuer (%)
                    </label>
                    <input
                      type="range"
                      name="taxRate"
                      min="0"
                      max="30"
                      step="0.1"
                      value={formData.taxRate}
                      onChange={handleInputChange}
                      style={{ 
                        width: '100%', 
                        height: '8px', 
                        backgroundColor: '#edf0f7', 
                        borderRadius: '4px', 
                        appearance: 'none', 
                        cursor: 'pointer' 
                      }}
                    />
                    <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '0.875rem', color: '#555', marginTop: '0.5rem' }}>
                      <span>0%</span>
                      <span>{formData.taxRate.toFixed(1)}%</span>
                      <span>30%</span>
                    </div>
                  </div>
                  
                  <div>
                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '500' }}>
                      Inflationsrate (%)
                    </label>
                    <input
                      type="range"
                      name="inflationRate"
                      min="0"
                      max="5"
                      step="0.1"
                      value={formData.inflationRate}
                      onChange={handleInputChange}
                      style={{ 
                        width: '100%', 
                        height: '8px', 
                        backgroundColor: '#edf0f7', 
                        borderRadius: '4px', 
                        appearance: 'none', 
                        cursor: 'pointer' 
                      }}
                    />
                    <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '0.875rem', color: '#555', marginTop: '0.5rem' }}>
                      <span>0%</span>
                      <span>{formData.inflationRate.toFixed(1)}%</span>
                      <span>5%</span>
                    </div>
                  </div>
                </div>
              )}
            </div>
          </div>
          
          <div className="card" style={{ 
            backgroundColor: 'white', 
            borderRadius: '12px', 
            boxShadow: '0 4px 12px rgba(0,0,0,0.1)', 
            padding: '2rem', 
            transition: 'all 0.3s ease', 
            position: 'relative', 
            display: 'flex', 
            flexDirection: 'column', 
            height: '100%' 
          }}>
            <h3 style={{ display: 'flex', alignItems: 'center', color: '#001d6c', marginBottom: '1rem' }}>
              <span style={{ 
                width: '40px', 
                height: '40px', 
                backgroundColor: '#e2fe6c', 
                borderRadius: '50%', 
                display: 'flex', 
                alignItems: 'center', 
                justifyContent: 'center', 
                marginRight: '1rem', 
                fontSize: '1.2rem', 
                fontWeight: 'bold', 
                boxShadow: '0 4px 8px rgba(0,0,0,0.1)', 
                flexShrink: '0' 
              }}>R</span>
              Ergebnisse
            </h3>
            
            <div style={{ display: 'flex', flexDirection: 'column', gap: '1.5rem' }}>
              <div style={{ 
                display: 'flex', 
                justifyContent: 'space-between', 
                alignItems: 'center', 
                padding: '1rem', 
                backgroundColor: '#e2fe6c', 
                borderRadius: '8px',
                fontWeight: '500'
              }}>
                <span>Endwert nach {formData.yearsToInvest} Jahren:</span>
                <span style={{ 
                  fontSize: '1.25rem', 
                  fontWeight: 'bold', 
                  color: '#001d6c' 
                }}>{formatter.format(summary.totalValue)}</span>
              </div>
              
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '1rem' }}>
                <div style={{ padding: '1rem', backgroundColor: '#edf0f7', borderRadius: '8px' }}>
                  <div style={{ fontSize: '0.875rem', color: '#555', marginBottom: '0.25rem' }}>Gesamte Einzahlungen</div>
                  <div style={{ fontWeight: 'bold', color: '#001d6c' }}>{formatter.format(summary.totalInvestment)}</div>
                </div>
                <div style={{ padding: '1rem', backgroundColor: '#edf0f7', borderRadius: '8px' }}>
                  <div style={{ fontSize: '0.875rem', color: '#555', marginBottom: '0.25rem' }}>Gewinn</div>
                  <div style={{ fontWeight: 'bold', color: '#001d6c' }}>{formatter.format(summary.totalReturns)}</div>
                </div>
                
                {showAdvanced && (
                  <>
                    <div style={{ padding: '1rem', backgroundColor: '#edf0f7', borderRadius: '8px' }}>
                      <div style={{ fontSize: '0.875rem', color: '#555', marginBottom: '0.25rem' }}>Nach Steuern</div>
                      <div style={{ fontWeight: 'bold', color: '#001d6c' }}>{formatter.format(summary.totalAfterTax)}</div>
                    </div>
                    <div style={{ padding: '1rem', backgroundColor: '#edf0f7', borderRadius: '8px' }}>
                      <div style={{ fontSize: '0.875rem', color: '#555', marginBottom: '0.25rem' }}>Reale Kaufkraft</div>
                      <div style={{ fontWeight: 'bold', color: '#001d6c' }}>{formatter.format(summary.totalAfterInflation)}</div>
                    </div>
                  </>
                )}
              </div>
              
              <div>
                <div style={{ fontSize: '0.875rem', color: '#555', marginBottom: '0.5rem' }}>Verhältnis Gewinn zu Einzahlungen</div>
                <div style={{ width: '100%', backgroundColor: '#edf0f7', borderRadius: '99px', height: '10px', overflow: 'hidden' }}>
                  <div 
                    style={{ 
                      backgroundColor: '#001d6c', 
                      height: '100%', 
                      borderRadius: '99px',
                      width: `${(summary.totalReturns / summary.totalValue) * 100}%` 
                    }}
                  ></div>
                </div>
                <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '0.75rem', color: '#555', marginTop: '0.5rem' }}>
                  <span>Einzahlungen: {((summary.totalInvestment / summary.totalValue) * 100).toFixed(0)}%</span>
                  <span>Gewinn: {((summary.totalReturns / summary.totalValue) * 100).toFixed(0)}%</span>
                </div>
              </div>
              
              <div style={{ marginTop: 'auto', borderTop: '1px solid #edf0f7', paddingTop: '1.5rem' }}>
                <h4 style={{ fontWeight: '600', marginBottom: '1rem', color: '#001d6c' }}>Schlüsselzahlen</h4>
                <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                    <span style={{ color: '#555' }}>Jährliche Rendite:</span>
                    <span style={{ fontWeight: '500' }}>{formData.expectedReturnRate}%</span>
                  </div>
                  <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                    <span style={{ color: '#555' }}>Monatliche Einzahlung:</span>
                    <span style={{ fontWeight: '500' }}>{formatter.format(formData.monthlyContribution)}</span>
                  </div>
                  <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                    <span style={{ color: '#555' }}>Rendite nach {formData.yearsToInvest} Jahren:</span>
                    <span style={{ fontWeight: '500' }}>{percentFormatter.format(summary.totalReturns / summary.totalInvestment)}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div className="tool" style={{ 
        backgroundColor: 'white', 
        borderRadius: '12px', 
        padding: '1.5rem 2rem', 
        boxShadow: '0 4px 12px rgba(0,0,0,0.1)', 
        transition: 'all 0.3s ease',
        marginBottom: '1.5rem'
      }}>
        <div style={{ borderBottom: '1px solid #edf0f7', marginBottom: '1.5rem' }}>
          <div style={{ display: 'flex', gap: '1.5rem' }}>
            <button
              style={{ 
                padding: '0.75rem 1rem', 
                backgroundColor: 'transparent',
                border: 'none',
                cursor: 'pointer',
                color: activeTab === 'wachstum' ? '#001d6c' : '#555',
                fontWeight: activeTab === 'wachstum' ? '600' : '400',
                borderBottom: activeTab === 'wachstum' ? '2px solid #e2fe6c' : 'none',
                transition: 'all 0.3s ease',
                fontSize: '1rem',
                fontFamily: 'inherit'
              }}
              onClick={() => setActiveTab('wachstum')}
            >
              Wachstumskurve
            </button>
            <button
              style={{ 
                padding: '0.75rem 1rem', 
                backgroundColor: 'transparent',
                border: 'none',
                cursor: 'pointer',
                color: activeTab === 'vergleich' ? '#001d6c' : '#555',
                fontWeight: activeTab === 'vergleich' ? '600' : '400',
                borderBottom: activeTab === 'vergleich' ? '2px solid #e2fe6c' : 'none',
                transition: 'all 0.3s ease',
                fontSize: '1rem',
                fontFamily: 'inherit'
              }}
              onClick={() => setActiveTab('vergleich')}
            >
              Rendite-Vergleich
            </button>
            <button
              style={{ 
                padding: '0.75rem 1rem', 
                backgroundColor: 'transparent',
                border: 'none',
                cursor: 'pointer',
                color: activeTab === 'aufteilung' ? '#001d6c' : '#555',
                fontWeight: activeTab === 'aufteilung' ? '600' : '400',
                borderBottom: activeTab === 'aufteilung' ? '2px solid #e2fe6c' : 'none',
                transition: 'all 0.3s ease',
                fontSize: '1rem',
                fontFamily: 'inherit'
              }}
              onClick={() => setActiveTab('aufteilung')}
            >
              Aufteilung
            </button>
          </div>
        </div>
        
        {renderActiveTab()}
      </div>
      
      <div style={{ textAlign: 'center', fontSize: '0.875rem', color: '#555', marginTop: '2rem' }}>
        <p>Hinweis: Diese Berechnungen dienen nur zu Informationszwecken und stellen keine Anlageberatung dar. 
        Die tatsächlichen Ergebnisse können aufgrund von Marktschwankungen, Steueränderungen und anderen Faktoren abweichen.</p>
      </div>
    </div>
  );
};

export default ETFSparplanrechner;
